<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Updated CSP:
       - Allow connections to script.google.com and script.googleusercontent.com
       - Allow styles from your own domain plus Google Fonts
       - Allow fonts from fonts.gstatic.com -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    connect-src 'self' https://script.google.com https://script.googleusercontent.com;
    script-src 'self' 'unsafe-inline';
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com;
  ">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Castro Crest</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@200..700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      font-family: 'Bebas Neue', sans-serif;
      color: #fff;
      height: 100%;
      margin: 0;
    }
    .home-bg {
      background-image: url('background.jpg');
      background-size: cover;
      background-position: center;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: flex-start;
      position: relative;
      padding: 60px;
    }
    .content {
      max-width: 800px;
    }
    nav {
      position: absolute;
      top: 20px;
      right: 40px;
      display: flex;
      gap: 20px;
    }
    nav a {
      font-family: 'Oswald', sans-serif;
      color: white;
      text-decoration: none;
      font-weight: bold;
      font-size: 18px;
      padding: 10px 20px;
      border-radius: 5px;
      transition: background-color 0.3s;
      background-color: transparent;
    }
    nav a:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }
    h1 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 48px;
      margin-bottom: 30px;
      text-shadow: none;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 15px;
      max-width: 600px;
      transition: opacity 1s ease;
    }
    label {
      font-weight: bold;
    }
    input, textarea {
      padding: 10px;
      width: 100%;
      border: none;
      border-radius: 4px;
      font-family: 'Bebas Neue', sans-serif;
    }
    textarea {
      maxlength: 2000;
    }
    button {
      width: fit-content;
      padding: 10px 20px;
      background-color: #fff;
      color: #000;
      font-weight: bold;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #ddd;
    }
    #success-message {
      position: absolute;
      left: 60px;
      bottom: 40px;
      color: white;
      font-weight: bold;
      font-size: 18px;
      opacity: 0;
      transform: translateY(0);
      transition: transform 2s ease, opacity 2s ease;
    }
  </style>
</head>
<body>
  <div class="home-bg">
    <nav>
      <a href="index.html">Home</a>
      <a href="thesis.html">Thesis</a>
      <a href="team.html">Team</a>
    </nav>
    <div class="content">
      <h1>Collaboration</h1>
      <p>Whether you're building something in biotech, innovating in digital health, or exploring a new scientific frontier, we want to hear from you. At Castro Crest, we value rigor, creativity, and execution. If you have an idea or project that aligns with our mission, submit a proposal — we’d love to explore how we can partner to bring it to life.</p>
      <form id="collabForm">
        <label for="name">Name</label>
        <input type="text" id="name" name="name" required>
        <label for="email">Email</label>
        <input type="email" id="email" name="email" required>
        <label for="message">Message</label>
        <textarea id="message" name="message" rows="4" maxlength="2000" placeholder="Write a short message..."></textarea>
        <button type="submit">Submit Proposal</button>
      </form>
      <div id="success-message">Success! Your proposal has been submitted.</div>
    </div>
  </div>
  <script>
    const form = document.getElementById('collabForm');
    const message = document.getElementById('success-message');

    form.addEventListener('submit', async function(e) {
      e.preventDefault();

      // Show loading state
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalBtnText = submitBtn.textContent;
      submitBtn.disabled = true;
      submitBtn.textContent = 'Sending...';

      try {
        // Convert form data to a plain object
        const formData = new FormData(form);
        const formObj = Object.fromEntries(formData.entries());
        // Optionally, add a timestamp
        formObj.timestamp = new Date().toISOString();
        console.log('Submitting:', formObj);

        // Replace the URL below with your freshly deployed Apps Script URL:
        const response = await fetch("https://script.google.com/macros/s/AKfycbxXDUP3s7KZ4bgxRNK8ruOfNuPThqSpXxWKy7s3Fi0SXgLEi94FLB_C76Sq-7AmDkwVzg/exec", {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formObj)
        });

        const result = await response.json();
        console.log('Response:', result);

        if (!response.ok || result.status !== 'success') {
          throw new Error(result.message || 'Submission failed');
        }

        // On success, animate the success message:
        message.style.opacity = 1;
        message.style.transform = 'translateY(-220px)';
        form.style.opacity = 0;

      } catch (error) {
        console.error('Error:', error);
        alert(`Failed to submit. ${error.message}\nPlease email wkatzka@gmail.com directly.`);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = originalBtnText;
      }
    });
  </script>
</body>
</html>
